<!DOCTYPE html>
<html lang="z-ch">
<head>
    <title>首页</title>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=8">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="keywords" content="HTML, CSS, JS, JavaScript, framework, bootstrap, front-end, frontend, web development">
    <meta name="author" content="设计：王齐 <wangqi@bootcss.com>">
    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/css/icon/iconfont.css" rel="stylesheet"/>
    <link href="/css/sidebar-menu.css" rel="stylesheet"/>
    <link href="/pagination/css/jquery.pagination.css" rel="stylesheet"/>
    <link href="/ztree/css/zTreeStyle/zTreeStyle.css" rel="stylesheet"/>
    <link href="/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet"/>
    <link href="/niceValidator/dist/jquery.validator.css" rel="stylesheet"/>
    <link href="/css/common.css" rel="stylesheet"/>
    <script src="/js/jquery-3.2.1.min.js" type="text/javascript"></script>
    <script src="/layer/layer.js" type="text/javascript"></script>
    <script src="/niceValidator/dist/jquery.validator.min.js?local=zh-CN" type="text/javascript"></script>
    <script src="/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/ztree/js/jquery.ztree.all.min.js"></script>
    <script src="/pagination/js/jquery.pagination.min.js"></script>
    <script src="/js/juicer.js"></script>
    <script src="/js/art.template.js"></script>
    <script src="/My97DatePicker/WdatePicker.js"></script>
    <script src="/js/boot.js"></script>
    <script src="/js/common.js"></script>
</head>
<body style="overflow: hidden">
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12 bg-primary" style="height: 70px">
            <div class="col-xs-2" style="line-height: 70px;font-size: 20px;font-weight: bold">Mine Platform云站平台</div>
            <div class="col-xs-10">
                <div class="row pull-right">
                    <div class="f_left">
                        <span class="glyphicon glyphicon-user"></span>&nbsp;管理员
                    </div>
                    <div class="f_left">
                        <span class="glyphicon glyphicon-home"></span>&nbsp;龙讯科技
                    </div>
                    <div class="f_left">
                        <span class="glyphicon glyphicon-map-marker"></span>&nbsp;合肥黄山路和谐花园
                    </div>
                    <div class="f_left">
                        <span class="glyphicon glyphicon-edit"></span>&nbsp;个人信息
                    </div>
                    <div class="f_left">
                        <span class="glyphicon glyphicon-off"></span>&nbsp;退出登录
                    </div>
                </div>
                <br/><br/>
                <div id="mainHeader" class="row header pull-right"></div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-1 main-sidebar"></div>
        <div class="col-xs-11">
            <div class="row table-bordered main-header">
                <span class="glyphicon glyphicon-map-marker text-info" aria-hidden="true"></span>
                &nbsp;<a href="#" id="moduleName">正在加载...</a>&nbsp;/&nbsp;<a href="#" id="functionName">正在加载...</a>
            </div>
            <div class="row" id="mainContainer" style="height:850px;overflow: auto">
                <span class="text-danger" style="margin: 0 15px">页面加载失败！</span>
            </div>
        </div>
    </div>
</div>
<div id="layerWin" class="hidden"></div>
<div id="layerWin2" class="hidden"></div>
</body>
<script src="/js/sidebar-menu.js"></script>
<script id="headerMenu" type="text/html">
    <ul>
        <% for( var i = 0 ; i < data.length ; i ++ ) {%>
        <li onclick="loadLeftMenu(this)" data-id="<%=data[i].id%>">
            <i class="iconfont <%=data[i].iconClass%>"></i>&nbsp;<%=data[i].name%>
        </li>
        <%}%>
    </ul>
    <div class="input-group pull-right">
        <input style="width: 150px;height: 25px;line-height: 25px;color:#1E9FFF;border-right: 0" type="text"
               class="form-control" placeholder="搜索站点信息"/>
        <a style="height: 25px;height: 25px;color:#1E9FFF;float: right;border-left: 0;margin-left: -3px"
           class="btn btn-default" href="#" role="button">
            <span class="glyphicon glyphicon-search" style="position: relative;top:-2px;left:2px"></span>
        </a>
    </div>
</script>
<script id="leftMenu" type="text/html">
    <% for( var i = 0 ; i < data.length ; i ++ ) {%>
    <% if(data[i].type == 'INDICATOR'){ %>
    <li class="header"><%=data[i].name%></li>
    <%}%>
    <%if(data[i].children.length > 0){%>
    <% for( var n = 0 ; n < data[i].children.length ; n ++ ) {%>
    <li class="treeview" type="<%=data[i].children[n].type%>" reqUrl="<%=data[i].children[n].reqUrl%>">
        <a href="#">
            <i class="iconfont <%=data[i].children[n].iconClass%> text-info"></i>
            <span><%=data[i].children[n].name%></span>
            <i class="iconfont icon-msnui-rightmini pull-right"></i>
        </a>
        <ul class="treeview-menu">
            <% for( var j = 0 ; j < data[i].children[n].children.length ; j ++ ) {%>
            <li type="<%=data[i].children[n].children[j].type%>" reqUrl="<%=data[i].children[n].children[j].reqUrl%>">
                <a href="#">
                    <i class="iconfont <%=data[i].children[n].children[j].iconClass%> text-warning"></i>
                    <span><%=data[i].children[n].children[j].name%></span>
                    <i class="iconfont icon-msnui-rightmini pull-right"></i>
                </a>
                <ul class="treeview-menu">
                    <%include('leftMenu',{data:data[i].children[n].children[j].children})%>
                </ul>
            </li>
            <%}%>
        </ul>
    </li>
    <%}%>
    <%}else{%>
    <li type="<%=data[i].type%>" reqUrl="<%=data[i].reqUrl%>">
        <a href="#">
            <i class="iconfont <%=data[i].iconClass%> text-danger"></i>
            <span><%=data[i].name%></span>
            <i class="iconfont icon-msnui-rightmini pull-right"></i>
        </a>
    </li>
    <%}%>
    <%}%>
</script>
<script>
    // 选择的模块、选择的业务功能
    var moduleName = "", functionName = "";
    $(document).ready(function () {
        loadSysMenu(1);
    });

    function loadSysMenu() {
        $.post("/menu/getMenuTree", {type: "CATAGORY"}, function (result) {
            $("#mainHeader").empty().html(template('headerMenu', {data: result}));
            $("#mainHeader ul li").click(function () {
                $(this).addClass('active-header').siblings().removeClass('active-header');
                moduleName = $(this).text().trim();
            });
            $("#mainHeader ul li:first").trigger("click");
        });
    }

    function loadLeftMenu(obj) {
        var id = $(obj).attr("data-id");
        $.post("/menu/getMenuTree", {id: id, queryFlag: '1'}, function (result) {
            $(".main-sidebar").empty().html("<ul class=\"sidebar-menu\">" + template('leftMenu', {data: result}) + "</ul>");
            $.sidebarMenu($('.sidebar-menu'));
            $('.sidebar-menu li').click(function () {
                var type = $(this).attr("type");
                var url = $(this).attr("reqUrl");
                if (type == 'STATIC' || type == 'URL') {
                    if (url == undefined || url == '') {
                        layer.alert("缺少地址参数，无法访问该功能！", {icon: 2});
                        return;
                    } else {
                        functionName = $(this).find("a > span").text().trim();
                        getMainHeader();
                        $("#mainContainer").empty().load(url, function (response, status, xhr) {
                            // console.log(response);// html
                            // console.log(status);// 请求状态
                            // console.log(xhr);// ajax信息
                            // console.log(this);// dom对象
                            // 400   （错误请求） 服务器不理解请求的语法。
                            // 401   （未授权） 请求要求身份验证。 对于需要登录的网页，服务器可能返回此响应。
                            // 403   （禁止） 服务器拒绝请求。
                            // 404   （未找到） 服务器找不到请求的网页。
                            // 405   （方法禁用） 禁用请求中指定的方法。
                            // 408   （请求超时）  服务器等候请求时发生超时。

                            // 500   （服务器内部错误）  服务器遇到错误，无法完成请求。
                            // 501   （尚未实施） 服务器不具备完成请求的功能。 例如，服务器无法识别请求方法时可能会返回此代码。
                            // 502   （错误网关） 服务器作为网关或代理，从上游服务器收到无效响应。
                            // 503   （服务不可用） 服务器目前无法使用（由于超载或停机维护）。 通常，这只是暂时状态。
                            // 504   （网关超时）  服务器作为网关或代理，但是没有及时从上游服务器收到请求。
                            // 505   （HTTP 版本不受支持） 服务器不支持请求中所用的 HTTP 协议版本。
                            if (status == 'error') {
                                var errorCode = xhr.status;
                                if (errorCode == '403') {
                                    $(this).load("/common/403");
                                } else if (errorCode == '404') {
                                    $(this).load("/common/404");
                                } else if (errorCode == '500') {
                                    $(this).load("/common/500");
                                } else if (errorCode == '404') {
                                    $(this).load("/common/503");
                                }
                            }
                        });
                    }
                }
            });
            $(".main-sidebar ul li").each(function () {
                if (this.type == 'URL') {
                    $(this).trigger('click').addClass('active');
                    return false;
                }
            });
        });
    }

    function getMainHeader() {
        $("#moduleName").html(moduleName);
        $("#functionName").html(functionName);
    }
    // Mine.layer.openWin("测试窗口","/test/miniui_grid","800","500");
    // Mine.layer.openIframe("测试窗口","/test/layerPage","400","300");
</script>
</html>